<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>test-pending-open</title>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="../dist/lib.js"></script>
  </head>
  <body>
    <h1>test-pending-open</h1>
    <script>
      function test(C) {
        var haderror = false;
        var requests = 10;
        var count = 0;
        var chan;

        function onopen() {
          if (++count == requests && !haderror) {
            return C();
          }
        }

        for (var i = 0; i < requests; i++) {
          chan = createTestChannel("rw", 1);
          chan.onopen = onopen;
          chan.onerror = function(err) {
            haderror = true;
            return !haderror && C(err);
          };
        }
      }

      initTest(30000, test);
    </script>
  </body>
</html>