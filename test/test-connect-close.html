<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>test-connect-close</title>
    <script type="text/javascript" src="common.js"></script>
    <script type="text/javascript" src="../dist/lib.js"></script>
  </head>
  <body>
    <h1>test-connect-close</h1>
    <script>

      function test(C) {
        var chan = createTestChannel("rw");

        chan.onopen = function() {
          if (!this.readable) return C(new Error("not readable"));
          if (!this.writable) return C(new Error("not writable"));
          chan.close();
        };

        chan.onerror = function(err) {
          C(err);
        };

        chan.onclose = function() {
          return C();
        };
      }

      initTest(30000, test);
    </script>
  </body>
</html>
